<html>
<head>
   <title>计算看这里</title>
    <!--添加新增日期按钮-->
    <link rel="stylesheet" href="css/jquery.cxcalendar.css">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <style>
        body{
            /*background:url(http://img2.niutuku.com/desk/1207/1044/ntk120631.jpg)*/
            font-size:1em;
            margin:0;
            padding:0;
        }
        span{
            vertical-align:middle;
        }
        #calculate{
            width:36%;
            padding:1%;
			position:absolute;
			left:32%;
			top:20%;
			height:60px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
		#onebox{
			position:absolute;
			width:50%;
			left:0;
			top:0;
			height:40px;
			clear:both;
			}
		#twobox{
			position:absolute;
			width:50%;
			left:50%;
			top:0;
			height:40px;
			}	
        #cal_cot{
			
			position:relative;
            margin-top:0;
            text-align:center;
        }
        #cal_cotn{
            text-align:center;
			margin-top:0;
			//margin:0;
			//padding:0;
        }
        .cal-date{
			display:block;
            height:100%;
            //margin-top:10%;
            //margin-right:2%;
            /*height:30px;*/
            /*margin-top:20px;*/
            /*margin-right:10px;*/
            width:100%;
			margin:0,auto;
            text-align:center;
        }
        .cho-date{
			display:block;
            width:100%;
			margin:0,auto;
			height:100%;
            /*height:26px;*/
            /*width:80px;*/
            text-align:center;
        }
        #selection{
            position:absolute;
            top:5%;
            left:21%;
            padding-left:2%;
            width:10%;
            /*margin-left:20%;*/
            float:left;
            overflow: hidden;
			display:none;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        .sel-p{
            float:left;
            margin:0;
            margin-right:8%;
            /*margin-right:10px;*/
        }
        #Btn{
            position:absolute;
            left:40%;
            top:80%;
            width:20%;
            height:8%;

            /*width:140px;*/
            /*height:44px;*/
            background:#4caf50;
            color:white;
            border:none;
            cursor:pointer;
        }
        #Btn:hover{
            background:#5caf10;
        }
        #outcome{
            position:absolute;
            left:30%;
            top:5%;
            width:50%;
            padding:2%;
            line-height:80%;
            font-size:0.8em;
			display:none;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        .date-text{
            width:15%;
            outline:none;
            border:1px solid white;
            border-bottom:1px solid black;
            text-align:center;
        }
        .out-it{
            margin-top:5%;
            height:10%;
            width:5%;
            /*margin-top:25px;*/
            outline:none;
            border:1px solid white;
            border-bottom:1px solid black;
            text-align:center;
        }
        #out_text{
            margin-top:-1%;
            margin-bottom:-1%;
            /*margin-top:-10px;*/
            /*margin-bottom:-10px;*/
        }
        #Textarea{
            position:absolute;
            left:32%;
            width:36%;
			top:40%;
            /*bottom:0;*/
            height:25%;
			line-height:25%;
            padding:1%;
            overflow:hidden;
            box-shadow: 0 4px 58px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            text-align:center;
        }
        #dv_textarea{
            border:1px solid white;
            color:black;
            height:65%;
            width:92%;
            line-height:100%;
            font-size:1.6em;
            text-align:center;
            overflow:hidden;
        }
       .mingxi {
            margin: auto 0;
            width: 100%;
            text-align: center;
          }
        /*@media only screen and (max-width:600px){
            #calculate{
                width:50%;
            }
            #selection{
                left:55%;
                width:30%;
            }
            #Btn{
                left:55%;
                width:40%;
            }
            #outcome{
                margin:auto 0;
                width:94%;
                left:1%;
                top:85%;
                font-size:0.4em;
            }
           #out_text{
               margin-top:2%;
               font-size:1.6em;
           }
            .date-text{
                font-size:0.1em;
            }
            #Textarea{
                left:50%;
                width:46%;
                font-size:0.5em;
                top:60%;
            }
            #dv_textarea{
                width:80%;
            }
        }
        /*#textarea{*/
            /*position:absolute;*/
            /*left:65%;*/
            /*top:30%;*/
            /*box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);*/
        /*}*/*/
    </style>
    <script>
        window.onload = function() {
            //得有个判断提示日期有问题！
//            var Inte1 = document.getElementById("date_a");
//            var Inte2 = document.getElementById("date_b");
//            var Inte3 = document.getElementById("date_c");
//            var Inte4 = document.getElementById("date_d");
//            var Inte5 = document.getElementById("date_e");
//            var Inte6 = document.getElementById("date_f");
//            var Inte7 = document.getElementById("date_g");
//            var Inte8 = document.getElementById("date_h");
//            var Inte9 = document.getElementById("date_i");
//            var Inte111 = document.getElementById("int111");
//            var Inte222 = document.getElementById("int222");
//            var Inte333 = document.getElementById("int333");
//            var Inte444 = document.getElementById("int444");
//            var Inte555 = document.getElementById("int555");
//            var Inte666 = document.getElementById("int666");
//            var Inte777 = document.getElementById("int777");
//            var Inte888 = document.getElementById("int888");

            var datenumber = document.getElementsByClassName('cal-date');
            var kong = [];
            var konger = [];
            var a, b;
            var mingXi = document.getElementsByClassName('mingxi');
            var jieGuo = document.getElementsByName('jieguo');
            var midnumber = 0;
            var keyy =0;

            var Inteall = document.getElementById("dv_textarea");
            var medism = 0;
            var Medisum = document.getElementsByClassName('cho-date');
            var Btn = document.getElementById("Btn");
            //全选按钮
            var Numpicker = document.getElementsByClassName("cho-date");
            var Checking0 = document.getElementById("checking0");
            var Checking1 = document.getElementById("checking1");
            var Checking2 = document.getElementById("checking2");
            var Checking3 = document.getElementById("checking3");
            var CheckSta = document.getElementsByClassName("check-sta");
            var allBox = $(":checkbox");
            allBox.click(function () {
                allBox.removeAttr("checked");
                $(this).prop("checked", true);
            });

            Checking0.onclick = function () {
                var a = this;
                if (Checking0.checked) {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 0;
                    }
                } else {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 0;
                    }
                }
            };
            Checking1.onclick = function () {
                if (Checking1.checked) {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 10;
                    }
                } else {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 0;
                    }
                }
            };
////为什么不能先判断复选框是否勾选
//            if(Checking2.checked){
//                Checking2.onclick = function(){
//                    alert(1);
//                }
//            }else{
//                alert(2)
//            }
            Checking2.onclick = function () {
                if (Checking2.checked) {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 20;
                    }
                } else {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 0;
                    }
                }
            };
            Checking3.onclick = function () {
                if (Checking3.checked) {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 30;
                    }
                } else {
                    for (var i = 0; i < Numpicker.length; i++) {
                        Numpicker[i].value = 0;
                    }
                }
            };
//*--*---------------------------------------------------------------------------------------------
            //点击按钮事件
            Btn.onclick = function clickk() {
                var datedui = document.getElementsByName('datetext');             //获得输入的日期值
                var dateduii = document.getElementsByName('datetext1');          //获得输入的日期值
                var meddui = document.getElementsByName('medtext');                 //获得所有药量值
                var riqicha = document.getElementsByName('text1');                      //日期差
                var chazhii = document.getElementsByName('chazhi');                 //日期药片差值
				var dateone = document.getElementById("date_a");
                var sum = 0;
                var asum = [];
                for (var i = 0; i < datenumber.length; i++) {
//                    asum.push(datenumber[i].value);
                    if (isNaN(Number(asum[i]))) {
                        asum[i] = 0;
                    }
                    sum += Number(asum[i]);
                    kong.push(datenumber[i].value);
                    konger.push(datenumber[i].value+"-"+Numpicker[i].value);
                }
//alert(konger[0]);
//                alert(konger[0].replace(/:\d{1,2}/,''));
//                alert(konger[0].slice(11,14));
//                for(var i =0;i<datenumber.length;i++){
//                    if(datenumber[i].value == ""){
//                        kong.push(0);
//                    }else{
//                        kong.push(datenumber[i].value);
//                    }
//                    alert(kong[i]);

                kong.sort();
                konger.sort();
                for(var i = 0;i<konger.length;i++){
                    if(konger[i].length < 5){
                        konger[i] = konger[i].replace("-","")
                    }else{
                        konger[i] = konger[i].slice(11);
                    }
                }
                //表格里的日期填写
                for (var i = 0; i < datedui.length; i++) {
//                    var indexx = i;
                    for (var k = 0; k < datenumber.length; k++) {
//                        if(kong[k] !== 0) {
//                            datedui[i].value = kong[k + i];
//                            if (k + i >= datedui.length) {
//                                dateduii[i].value = "Kong";
//                            } else {
//                                dateduii[i].value = kong[k + i + 1];
//                            }
//                            break;
//                        }
//                    }
                        if (kong[k] !== "") {
                            datedui[i].value = kong[k + i];
//                            meddui[i].value = konger[k + i].replace(/[^(:{1,2})]/,"");
                            meddui[i].value = konger[k + i];
                            chazhii[i].value =new Date((Date.parse( datedui[i].value )+Number(meddui[i].value * 86400000))).toLocaleDateString();
                            if (k +i+ 1 >= datenumber.length) {
                                dateduii[i].value = "空";
                                if(i+1 >=dateduii.length){
                                    mingXi[i].style.display = 'none';
                                }else{
                                    mingXi[i+1].style.display = 'none';
                                }
                            } else {
                                dateduii[i].value = kong[k + i+1];
                                mingXi[i+1].style.display = "block";
                                keyy = Date.parse( datedui[i].value )+Number(meddui[i].value * 86400000) - Date.parse(dateduii[i].value);
                                if(keyy >= 0){
                                    midnumber += keyy/86400000;
                                    jieGuo[i].value = "正常";
                                    jieGuo[i].style.color = "black";
                                }else if(keyy/86400000 + midnumber >= 0) {
                                    jieGuo[i].value = "正常";
                                    jieGuo[i].style.color = "black";
                                }else if(keyy/86400000 + midnumber < -15){
                                    jieGuo[i].value = "断药";
                                    jieGuo[i].style.color = "red";
                                }else{
                                    jieGuo[i].value = "正常";
                                    jieGuo[i].style.color = "black";
                                }

                            }
                            break;
                        }
                    }

                }
                for (var i = 0; i < kong.length; i++) {
                    if (kong[i] != 0) {
                        a = kong[i];
                        break;
                    }
                }
                b = kong[kong.length - 1];
                for (var i = 0; i < Medisum.length ; i++) {
                    medism += (Number(Medisum[i].value));
                }
                var c = Math.floor((Date.parse(b) - Date.parse(a)) / 86400000);
				if(!dateone.value){
					return
				}else{
			
                //Inteall.value =a +" 至 "+ b +" 期间\n应用药 " + c +" 天,实际购药 "+ medism + " 粒,理论截止治疗日期为" +
                        //new Date((Date.parse(a)+Number(medism*86400000))).toLocaleDateString() +"日.";
                Inteall.value =a +"购药 "+ medism + " 粒,能够坚持到" +
                        new Date((Date.parse(a)+Number(medism*86400000))).toLocaleDateString() +".";						
						}




//                    datedui[i].value =datenumber[i].value;\
//                    datedui[i].value = kong[i].value;
//                    dateduii[i].value = datenumber[i+1].value;
//                    chazhii[i].value = riqicha[i].value - meddui[i].value;

//结果判定


//清除再次点击时的影响
                kong = [];
                konger = [];
                sum = [];
                medism = 0;
                keyy = 0;
                midnumber = 0;
            }

            };
            document.onkeydown = hotkey;
        function hotkey(){
                if(window.event.keyCode == 13){
                   Btn.onclick();
                }
            }
    </script>
</head>
<body>
<div id="calculate">
	<div id="onebox">
		<p id="cal_cot">日期</p>
		<input type="text" name="date1" id="date_a" class="cal-date" >
	</div>
	<div id="twobox">
		<p id="cal_cotn">数量</p>
		<input type="number" id="date_aa" class="cho-date" value="0">
	</div>
    <br/>
    <!--<input type="text" name="date2" id="date_b" class="cal-date">
    <input type="number" id="date_bb" class="cho-date" value="0">
    <br/>
    <input type="text" name="date3" id="date_c" class="cal-date">
    <input type="number" id="date_cc" class="cho-date" value="0">
    <br/>
    <input type="text" name="date4" id="date_d" class="cal-date">
    <input type="number" id="date_dd" class="cho-date" value="0">
    <br/>
    <input type="text" name="date5" id="date_e" class="cal-date">
    <input type="number" id="date_ee" class="cho-date" value="0">
    <br/>
    <input type="text" name="date6" id="date_f" class="cal-date">
    <input type="number" id="date_ff" class="cho-date" value="0">
    <br/>
    <input type="text" name="date7" id="date_g" class="cal-date">
    <input type="number" id="date_gg" class="cho-date" value="0">
    <br/>
    <input type="text" name="date8" id="date_h" class="cal-date">
    <input type="number" id="date_hh" class="cho-date" value="0">
    <br/>
    <input type="text" name="date9" id="date_i" class="cal-date">
    <input type="number" id="date_ii" class="cho-date" value="0">
    <br/>-->

</div>

<div id="selection">
    <p class="sel-p"><input name="kk" type="checkbox" id="checking0" class="check-sta">0</p>
    <p class="sel-p"><input name="kk" type="checkbox" id="checking1" class="check-sta">10</p>
    <p class="sel-p"><input name="kk" type="checkbox" id="checking2" class="check-sta">20</p>
    <p class="sel-p"><input name="kk" type="checkbox" id="checking3" class="check-sta">30</p>
</div>

    <button  name="Btn" id="Btn">しね</button>
<br/>
<div id="outcome">
<p id="out_text">明细：</p>
    <div  id="mingxi1" class="mingxi">
        <input type="text" name="datetext" id="date_text1" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text1" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi1" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text2" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo1" class = "out-it">
    </div>
    <div  id="mingxi2" class="mingxi">
        <input type="text" name="datetext" id="date_text3" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text2" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi2" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text4" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo2" class = "out-it">
    </div>
    <div  id="mingxi3" class="mingxi">
        <input type="text" name="datetext" id="date_text5" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text3" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi3" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text6" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo3" class = "out-it">
    </div>
    <div  id="mingxi4" class="mingxi">
        <input type="text" name="datetext" id="date_text7" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text4" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi4" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text8" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo4" class = "out-it">
    </div>
    <div  id="mingxi5" class="mingxi">
        <input type="text" name="datetext" id="date_text9" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text5" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi5" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text10" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo5" class = "out-it">
    </div>
    <div  id="mingxi6" class="mingxi">
        <input type="text" name="datetext" id="date_text11" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text6" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi6" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text12" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo6" class = "out-it">
    </div>
    <div  id="mingxi7" class="mingxi">
        <input type="text" name="datetext" id="date_text13" class="date-text">
        <span>购药</span>
        <input type="text" name="medtext" id="med_text7" class="out-it">
        <span>粒，理论治疗截止日期：</span>
        <input type="text" name="chazhi" id="chazhi7" class="date-text">
        <span>再次购药日期：</span>
        <input type="text" name="datetext1" id="date_text14" class="date-text">
        <span>&nbsp;&nbsp;</span>
        <input type="text" name="jieguo" id="jieguo7" class = "out-it">
    </div>

<br/>
<!--<input type="text" name="text8" id="int888" class="out-it">-->
<br/>
<!--<input type="text" name="textsum" id="atext" class="out-it">-->
</div>
<div id="Textarea">
    <p style="font-weight:bold"></p>
    <textarea id="dv_textarea" cols="60" rows="5"></textarea>
</div>





<script src="jquery-3.2.1.min.js"></script>
<script src="jquery2.1.1-rc2-jquery.min.js"></script>
<script src="js/jquery.cxcalendar.min.js"></script>
<script src="js/jquery.cxcalendar.languages.js"></script>
<script>
    $.cxCalendar.defaults.startDate = 2015;
    $.cxCalendar.defaults.endDate = 2024;
    $('#date_a').cxCalendar();
    $('#date_b').cxCalendar();
    $('#date_c').cxCalendar();
    $('#date_d').cxCalendar();
    $('#date_e').cxCalendar();
    $('#date_f').cxCalendar();
    $('#date_g').cxCalendar();
    $('#date_h').cxCalendar();
    $('#date_i').cxCalendar();
</script>

</body>
</html>
